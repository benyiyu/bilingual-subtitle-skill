# 与 Claude 协作开发 Bilingual Subtitle Skill 全记录

> 本文档记录了从零开始创建一个 Claude Code Skill 的完整过程，适合作为视频/文章素材。

## 项目背景

**目标**: 创建一个可以自动生成双语字幕并烧录到视频的工具

**为什么选择 Claude Code Skill？**
- 可以用自然语言调用复杂功能
- 一次配置，永久可用
- 支持参数化，灵活度高

---

## 第一阶段：需求确认与设计

### 对话片段

```
我: 我想自己做一个 Skills，用于生成双语字幕
Claude: 这个 Skill 可以分两步完成...
```

### 设计决策

1. **两步工作流**
   - Step 1: 翻译字幕 (SRT → 双语 SRT)
   - Step 2: 烧录到视频 (视频 + SRT → 带字幕视频)

2. **为什么分两步？**
   - 灵活性：可以只翻译不烧录
   - 可检查：翻译后可人工校对
   - 节省成本：烧录失败不需要重新翻译

---

## 第二阶段：环境配置

### 遇到的第一个坑：ffmpeg

```bash
# 标准版 ffmpeg 不支持字幕滤镜
brew install ffmpeg  # ❌ 缺少 libass

# 需要安装完整版
brew install ffmpeg-full  # ✅ 包含 libass
```

**关键发现**: macOS 上 ffmpeg-full 的路径是 `/opt/homebrew/opt/ffmpeg-full/bin/ffmpeg`

---

## 第三阶段：英文视频测试 (1080p)

### 测试素材
- 视频: DeepMind CEO Demis Hassabis 访谈
- 分辨率: 1080p
- 语言: 英语 → 中英双语

### 结果
**成功！** 字幕显示正常，位置合适。

---

## 第四阶段：日文视频测试 (4K) - 问题爆发

### 测试素材
- 视频: Comandante 咖啡器具介绍
- 分辨率: 4K (3840x2160)
- 语言: 日语 → 日中双语

### 问题 1: 字幕时间轴重叠

**现象**: 两段字幕叠在一起显示，然后下一个画面又没有字幕

**原因**: YouTube 自动生成的字幕时间轴不准确

**解决方案**: 使用 Buzz (Whisper) 重新生成 SRT
```
Buzz 优点:
- 基于 OpenAI Whisper 模型
- 时间轴准确不重叠
- 支持本地离线运行
```

### 问题 2: 字幕变成黑色块

**现象**: 字幕区域变成纯黑色矩形，看不到文字

**原因**: ffmpeg 命令中的颜色参数 `&H00FFFFFF` 的 `&` 符号被 shell 错误解析

**解决方案**: 使用 heredoc 创建临时脚本

```bash
# ❌ 直接执行会出错
ffmpeg -vf "subtitles=...:force_style='PrimaryColour=&H00FFFFFF'"

# ✅ 使用脚本包装
cat > /tmp/burn_subtitle.sh << 'SCRIPT'
#!/bin/bash
ffmpeg -vf "subtitles=...:force_style='PrimaryColour=&H00FFFFFF'"
SCRIPT
```

### 问题 3: 字号太大，位置太高

**迭代过程**:

| 版本 | FontSize | MarginV | 效果 |
|------|----------|---------|------|
| v5 | 28 | 35 | 字号太大，挡住画面主体 |
| v8 | 18 | 80 | 字号OK，但位置没变化 |

**关键发现**: MarginV 是从底边往上的像素偏移
- MarginV 越小 → 字幕越靠近底边
- MarginV 越大 → 字幕越往上

（之前理解反了！）

### 最终参数确定

经过 v5 → v11 共 7 个版本的迭代：

```
FontSize = 16
MarginV = 10
```

**效果**: 字幕大小适中，位置贴近底边，不遮挡画面主体。

---

## 第五阶段：Skill 完善

### 最终 Skill 结构

```
~/.claude/skills/bilingual-subtitle/
└── SKILL.md
```

### SKILL.md 关键内容

```yaml
---
name: bilingual-subtitle
description: 生成多语言双语字幕并烧录到视频
argument-hint: "[step1|step2] [语言:en-cn|ja-cn] [文件路径]"
allowed-tools: Bash, Read, Write, Edit, Glob
---
```

---

## 技术总结

### 1. ffmpeg 字幕样式参数

```
FontName=PingFang SC    # 字体（支持中日英）
FontSize=16             # 字号
PrimaryColour=&H00FFFFFF # 白色文字
BackColour=&H80000000   # 半透明黑色背景
BorderStyle=4           # 不透明背景框
MarginV=10              # 底边距
```

### 2. 不同分辨率参数

| 分辨率 | FontSize | MarginV |
|--------|----------|---------|
| 1080p | 12 | 8 |
| 1440p | 14 | 9 |
| 4K | 16 | 10 |

### 3. 推荐工具链

```
Buzz (Whisper) → Claude Code → ffmpeg-full
     ↓              ↓              ↓
  生成 SRT      翻译双语       烧录视频
```

---

## 协作感受

与 Claude 协作开发的几个特点：

1. **快速原型**: 从想法到可用 Skill 只用了一个下午
2. **即时调试**: 每次修改参数都能立即看到效果
3. **问题排查**: Claude 能快速定位 shell 转义等技术问题
4. **知识互补**: 我提供使用场景和视觉反馈，Claude 提供技术实现

---

## 文件清单

发布到 GitHub 的文件：

```
bilingual-subtitle-skill/
├── README.md              # 项目说明
├── RELEASE_NOTES.md       # 版本记录
├── SKILL.md               # Skill 定义文件
├── scripts/
│   └── burn_subtitle.sh   # ffmpeg 烧录脚本
└── 开发文档_协作过程.md    # 本文档
```

---

## 适合分享的内容角度

### 小红书/微信公众号

1. **标题建议**:
   - "我用 Claude 做了一个双语字幕神器"
   - "程序员 + AI = 效率翻倍？实战记录"
   - "Claude Code Skills 开发全记录"

2. **重点展示**:
   - 对比截图 (v5 vs v11)
   - 问题解决过程
   - 最终效果展示

### 视频内容

1. **开场**: 展示最终效果（带双语字幕的视频）
2. **问题引入**: 为什么需要这个工具
3. **开发过程**: 与 Claude 对话的屏幕录制
4. **踩坑记录**: shell 转义、MarginV 方向等
5. **结尾**: 如何安装使用

---

*本文档由 Ben 与 Claude (Opus 4.5) 协作编写*
